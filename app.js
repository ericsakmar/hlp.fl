// Generated by CoffeeScript 1.6.3
(function(){var e,t;e=function(){function e(e){this.name=e;this.tasks=[]}e.prototype.addTask=function(e,t){return t?this.setNext(e):this.tasks.splice(0,0,e)};e.prototype.setNext=function(e){this.next!=null&&this.addTask(this.next);return this.next=e};return e}();t=function(){function e(e){this.name=e;this.created=new Date}return e}();this.app=angular.module("app",[]);this.app.run(["$rootScope",function(e){return e.appName="hlpr"}]);this.app.factory("Projects",function(){return{openDb:function(e){var t,n;t=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;n=t.open("hlpr",2);n.onerror=function(e){return console.log(e)};n.onsuccess=function(t){var r;r=n.result;r.onerror=function(e){return console.log(e)};return e(r)};return n.onupgradeneeded=function(e){var t,n;t=e.target.result;return n=t.createObjectStore("projects",{keyPath:"name"})}},findAll:function(e){return this.openDb(function(t){var n;n=[];return t.transaction(["projects"]).objectStore("projects").openCursor().onsuccess=function(t){var r;r=t.target.result;if(r!=null){n.push(r.value);return r["continue"]()}return e(n)}})},find:function(e,t){return this.openDb(function(n){return n.transaction(["projects"]).objectStore("projects").get(e).onsuccess=function(e){return t(e.target.result)}})},findOrCreate:function(t,n){return this.find(t,function(r){return r!=null?n(r):n(new e(t))})},store:function(e,t){return this.openDb(function(n){return n.transaction(["projects"],"readwrite").objectStore("projects").add(e).onsuccess=function(n){console.log(n.target.result);return t(e)}})}}});this.app.controller("TaskListController",["$scope","Projects",function(e,n){var r,i,s,o;o=function(){return n.findAll(function(t){return e.$apply(function(){return e.projects=t})})};o();e.newTask="@test new task";e.createTask=function(){var u;u=i(e.newTask);return n.findOrCreate(u,function(i){var u,a,f;f=s(e.newTask);a=new t(f);u=r(e.newTask);i.addTask(a,u);return n.store(i,function(e){return o()})})};i=function(e){return/^\@[\w>\-]+/.exec(e)[0]};s=function(e){return/\s[\w\s]+!?$/.exec(e)[0].replace(/(^\s)|(!$)/g,"")};return r=function(e){return e.indexOf("!")===e.length-1}}])}).call(this);